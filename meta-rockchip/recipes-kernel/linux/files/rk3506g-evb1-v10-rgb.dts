// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2024 Rockchip Electronics Co., Ltd.
 * RGB888 Display Configuration for RK3506G EVB
 */

/dts-v1/;

#include "rk3506.dtsi"
#include "rk3506-evb1-v10.dtsi"
#include <dt-bindings/display/media-bus-format.h>

/ {
	model = "Rockchip RK3506G(QFN128) EVB1 V10 Board + RGB888 Display";
	compatible = "rockchip,rk3506g-evb1-v10-rgb", "rockchip,rk3506";

	chosen {
		bootargs = "earlycon=uart8250,mmio32,0xff0a0000,115200 console=ttyFIQ0,115200 storagemedia=sd root=/dev/mmcblk0p3 rootfstype=ext4 rw rootwait";
	};

	extcon_usb: extcon-usb {
		compatible = "linux,extcon-usb-gpio";
		vbus-gpio = <&gpio1 RK_PC5 GPIO_ACTIVE_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&usb_extcon_vbus>;
		status = "okay";
	};

	vcc5v0_otg0: vcc5v0-otg0-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc5v0_otg0";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		enable-active-high;
		gpio = <&gpio1 RK_PC4 GPIO_ACTIVE_HIGH>;
		vin-supply = <&vcc_sys>;
		regulator-state-mem {
			regulator-off-in-suspend;
		};
	};

	/* RGB888 LCD Panel Configuration */
	panel: panel {
		compatible = "simple-panel";
		bus-format = <MEDIA_BUS_FMT_RGB888_1X24>;
		backlight = <&backlight>;
		
		/* Panel Control GPIOs - ADJUST THESE FOR YOUR HARDWARE */
		/* Note: GPIO assignments depend on your hardware connections */
		enable-gpios = <&gpio0 RK_PA1 GPIO_ACTIVE_LOW>;
		enable-delay-ms = <20>;
		reset-gpios = <&gpio0 RK_PA7 GPIO_ACTIVE_LOW>;
		reset-delay-ms = <10>;
		
		status = "okay";

		/* Display Timing Parameters - EXAMPLE VALUES */
		/* IMPORTANT: Replace these with your actual LCD panel specifications */
		/* Get these values from your LCD panel datasheet */
		display-timings {
			native-mode = <&rgb_timing>;

			rgb_timing: timing0 {
				/* Example: 1024x600 @ 60Hz RGB LCD */
				/* Pixel clock = (htotal * vtotal * refresh_rate) */
				clock-frequency = <51200000>;
				
				/* Horizontal parameters */
				hactive = <1024>;
				hfront-porch = <160>;
				hsync-len = <24>;
				hback-porch = <160>;
				
				/* Vertical parameters */
				vactive = <600>;
				vfront-porch = <12>;
				vsync-len = <2>;
				vback-porch = <23>;
				
				/* Signal polarities */
				hsync-active = <0>;
				vsync-active = <0>;
				de-active = <0>;
				pixelclk-active = <0>;
			};
		};

		port {
			panel_in_rgb: endpoint {
				remote-endpoint = <&rgb_out_panel>;
			};
		};
	};
};

&cma {
	size = <0x1600000>;
};

/* Enable RGB Controller */
&rgb {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rgb888_pins>;

	ports {
		rgb_out: port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			rgb_out_panel: endpoint@0 {
				reg = <0>;
				remote-endpoint = <&panel_in_rgb>;
			};
		};
	};
};

/* Enable RGB input from VOP */
&rgb_in_vop {
	status = "okay";
};

/* Enable RGB routing */
&route_rgb {
	status = "okay";
};

/* USB OTG Configuration */
&u2phy_otg0 {
	rockchip,vbus-always-on;
};

&usbdrd30 {
	status = "okay";
};

&usbdrd_dwc3_0 {
	status = "okay";
	dr_mode = "otg";
	extcon = <&extcon_usb>;
};

&usbhost {
	status = "okay";
};

&usbhost_dwc2 {
	status = "okay";
};

/* PWM for Backlight Control */
&pwm1 {
	status = "okay";
	pinctrl-names = "active";
	pinctrl-0 = <&pwm1m0_pins>;
};

/* I2C for potential touch controller or other peripherals */
&i2c2 {
	status = "okay";
	clock-frequency = <400000>;
};

/* Pin Control for USB Detection */
&pinctrl {
	usb {
		usb_extcon_vbus: usb-extcon-vbus {
			rockchip,pins = <1 RK_PC5 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
};

